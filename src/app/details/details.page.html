<!-- Modern Header -->
<ion-header [translucent]="true">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" class="custom-back-button"></ion-back-button>
    </ion-buttons>
</ion-header>

<ion-content [fullscreen]="true" class="details-content">

  <!--  LOADING STATE - Skeletons während Daten geladen werden -->
  @if (isLoading()) {
  <div class="loading-container">
    <!-- Hero Skeleton -->
    <div class="skeleton-card">
      <div class="poster-skeleton">
        <ion-skeleton-text [animated]="true" style="width: 200px; height: 300px;"></ion-skeleton-text>
      </div>
      <div class="content-skeleton">
        <ion-skeleton-text [animated]="true" style="width: 80%;"></ion-skeleton-text>
        <ion-skeleton-text [animated]="true" style="width: 60%;"></ion-skeleton-text>
        <ion-skeleton-text [animated]="true" style="width: 40%;"></ion-skeleton-text>
      </div>
    </div>
  </div>
  }

  @else if (error()) {
  <!-- Error State -->
  <div class="error-container">
    <div class="error-content">
      <ion-icon name="alert-circle-outline" class="error-icon"></ion-icon>
      <h2>Oops! Fehler beim Laden</h2>
      <p>{{ error() }}</p>
      <ion-button (click)="loadMovieData()" class="retry-button">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Erneut versuchen
      </ion-button>
    </div>
  </div>
  }
  <!--  MOVIE CONTENT - Hauptinhalt wenn Daten geladen -->

  @else if (movie()) {
  <!--  HERO SECTION - Poster, Titel, Actions -->
  <div class="hero-section">
    <div class="poster-container">
      <img [src]="imageBaseUrl + '/w500' + movie()!.poster_path" [alt]="movie()!.title + ' Poster'"
        (error)="onImageError($event)" class="poster-image">

      <!--  RATING BADGE - Dynamische Farbe basierend auf Score -->
      <div class="rating-badge" [ngClass]="'rating-' + getRatingColor(movie()!.vote_average)">
        <ion-icon name="star" class="star-icon"></ion-icon>
        <span>{{ movie()!.vote_average | number:'1.1-1' }}</span>
      </div>
    </div>

    <div class="movie-info">
      <h1 class="movie-title">{{ movie()!.title }}</h1>

      <!--  TAGLINE (falls vorhanden) -->
      @if (movie()!.tagline) {
      <p class="movie-tagline">{{ movie()!.tagline }}</p>
      }

      <!--  GENRES - Erste 3 Genres anzeigen -->
      @if (movie()!.genres && movie()!.genres.length > 0) {
      <div class="genres-container">
        @for (genre of getMainGenres(movie()!.genres); track genre.id) {
        <span class="genre-chip">{{ genre.name }}</span>
        }
      </div>
      }

      <!--  ACTION BUTTONS - Interaktive Buttons -->
      <div class="action-buttons">
        <!--  WATCHLIST BUTTON - Toggle-Funktion -->
        <ion-button fill="solid" class="watchlist-button" (click)="toggleWatchlist()">
          <ion-icon [name]="isInWatchlist() ? 'bookmark' : 'bookmark-outline'" slot="start">
          </ion-icon>
          {{ isInWatchlist() ? 'Entfernen' : 'Zur Watchlist' }}
        </ion-button>

        <!--  TRAILER BUTTON - Nur anzeigen wenn Trailer vorhanden -->
        @if (trailer()) {
        <ion-button fill="outline" class="trailer-button" (click)="playTrailer()">
          <ion-icon name="play-outline" slot="start"></ion-icon>
          Trailer
        </ion-button>
        }
        <!--  SHARE BUTTON - Web Share API mit Clipboard Fallback -->
        <ion-button fill="outline" class="share-button" [disabled]="!isWebShareSupported()" (click)="shareMovie()">
          <ion-icon name="share-outline" slot="start"></ion-icon>
          {{ isWebShareSupported() ? 'Teilen' : 'Nicht verfügbar' }}
        </ion-button>
      </div>
    </div>
  </div>

  <!-- OVERVIEW CARD - Filmbeschreibung -->
  @if (movie()!.overview) {
  <div class="content-card">
    <div class="card-header">
      <h2 class="card-title">
        <ion-icon name="document-text-outline" class="card-icon"></ion-icon>
        Beschreibung
      </h2>
    </div>
    <div class="card-content">
      <p class="overview-text">{{ movie()!.overview }}</p>
    </div>
  </div>
  }

  <!-- MOVIE DETAILS CARD - Technische Details -->
  <div class="content-card">
    <div class="card-header">
      <h2 class="card-title">
        <ion-icon name="information-circle-outline" class="card-icon"></ion-icon>
        Film-Details
      </h2>
    </div>
    <div class="card-content">
      <div class="details-grid">

        <!-- Release Date -->
        <div class="detail-item">
          <ion-icon name="calendar-outline" class="detail-icon"></ion-icon>
          <div class="detail-content">
            <span class="detail-label">Veröffentlichung</span>
            <span class="detail-value">{{ movie()!.release_date | date: 'mediumDate' }}</span>
          </div>
        </div>

        <!-- Runtime -->
        @if (movie()!.runtime) {
        <div class="detail-item">
          <ion-icon name="time-outline" class="detail-icon"></ion-icon>
          <div class="detail-content">
            <span class="detail-label">Laufzeit</span>
            <span class="detail-value">{{ formatRuntime(movie()!.runtime) }}</span>
          </div>
        </div>
        }

        <!-- Budget -->
        @if (movie()!.budget && movie()!.budget > 0) {
        <div class="detail-item">
          <ion-icon name="cash-outline" class="detail-icon"></ion-icon>
          <div class="detail-content">
            <span class="detail-label">Budget</span>
            <span class="detail-value">{{ formatBudget(movie()!.budget) }}</span>
          </div>
        </div>
        }

        <!-- Rating -->
        <div class="detail-item">
          <ion-icon name="star-outline" class="detail-icon"></ion-icon>
          <div class="detail-content">
            <span class="detail-label">Bewertung</span>
            <span class="detail-value">{{ movie()!.vote_average | number:'1.1-1' }}/10</span>
          </div>
        </div>

        <!-- Language -->
        <div class="detail-item">
          <ion-icon name="language-outline" class="detail-icon"></ion-icon>
          <div class="detail-content">
            <span class="detail-label">Sprache</span>
            <span class="detail-value">{{ movie()!.original_language | uppercase }}</span>
          </div>
        </div>

        <!-- Status -->
        @if (movie()!.status) {
        <div class="detail-item">
          <ion-icon name="checkmark-circle-outline" class="detail-icon"></ion-icon>
          <div class="detail-content">
            <span class="detail-label">Status</span>
            <span class="detail-value">{{ movie()!.status }}</span>
          </div>
        </div>
        }

      </div>

      <!-- Homepage Link -->
      @if (movie()!.homepage) {
      <div class="homepage-link">
        <ion-button fill="clear" href="{{ movie()!.homepage }}" target="_blank" class="external-link">
          <ion-icon name="link-outline" slot="start"></ion-icon>
          Offizielle Website
          <ion-icon name="open-outline" slot="end"></ion-icon>
        </ion-button>
      </div>
      }
    </div>
  </div>

  <!--  CAST SECTION - Schauspieler und Besetzung -->
  @if (cast() && cast().length > 0) {
  <div class="content-card">
    <div class="card-header">
      <h2 class="card-title">
        <ion-icon name="people-outline" class="card-icon"></ion-icon>
        Schauspieler
      </h2>
    </div>
    <div class="card-content">
      <div class="cast-grid">
        @for (actor of mainCast(); track actor.id) {
        <div class="cast-item">
          <div class="actor-image-container">
            <img [src]="getProfileUrl(actor.profile_path)" [alt]="actor.name" (error)="onImageError($event, 'profile')"
              class="actor-image">
          </div>
          <div class="actor-info">
            <h3 class="actor-name">{{ actor.name }}</h3>
            <p class="actor-character">{{ actor.character }}</p>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
  }

  <!-- Production Companies -->
  @if (movie()!.production_companies && movie()!.production_companies.length > 0) {
  <div class="content-card">
    <div class="card-header">
      <h2 class="card-title">
        <ion-icon name="business-outline" class="card-icon"></ion-icon>
        Produktionsfirmen
      </h2>
    </div>
    <div class="card-content">
      <div class="companies-grid">
        @for (company of movie()!.production_companies; track company.id) {
        <div class="company-item">
          <h3 class="company-name">{{ company.name }}</h3>
          @if (company.origin_country) {
          <span class="company-country">{{ company.origin_country }}</span>
          }
        </div>
        }
      </div>
    </div>
  </div>
  }

  }

</ion-content>
